承知いたしました。先の設計に基づき、Go言語製 `gitignore` ジェネレーター **mushi** の詳細な要件定義書をまとめます。

---

## 📄 mushi: `gitignore` テンプレートジェネレーター要件定義書

### 1. 📂 ファイル構造とパス管理

| 種別 | パス (環境変数展開後) | 用途 | 補足 |
| :--- | :--- | :--- | :--- |
| **実行ファイル** | `$PATH/mushi` | CLIコマンド本体 | Go言語でビルド |
| **設定ディレクトリ** | `~/.config/mushi/` | ユーザー設定ファイルの保存場所 | `$XDG_CONFIG_HOME` に準拠 |
| **共通無視ファイル** | `~/.config/mushi/common.ignore` | 全ての `.gitignore` に連結される共通パターン | ファイルが存在しない場合は自動作成 |
| **キャッシュディレクトリ** | `~/.cache/mushi/github-gitignore/` | `github/gitignore` リポジトリのローカルキャッシュ | `$XDG_CACHE_HOME` に準拠 |
| **出力ファイル** | `./.gitignore` | テンプレートと共通設定を結合した結果ファイル | `mushi create` 実行ディレクトリに出力 |

---

### 2. ⚙️ CLIコマンド定義と動作

`mushi` は **Cobra** を利用して以下のコマンド体系を構築します。

#### 2.1. `mushi create` (メイン機能)

テンプレートを指定して `.gitignore` を生成します。

| コマンド | オプション | 説明 | 動作 |
| :--- | :--- | :--- | :--- |
| `mushi create <Template>` | なし | 指定されたテンプレート名で `.gitignore` を生成 | 1. **キャッシュ確認・取得** -> 2. **テンプレート読み込み** -> 3. **共通無視ファイル連結** -> 4. `./.gitignore` へ書き出し |
| `mushi create -i` | `-i`, `--interactive` | インタラクティブモードでテンプレートを選択 | 1. **キャッシュ確認・取得** -> 2. **絞り込みUI表示** -> 3. **選択されたテンプレートで生成** |

#### 2.2. `mushi cache` (キャッシュ管理)

ローカルキャッシュを操作します。

| コマンド | オプション | 説明 | 動作 |
| :--- | :--- | :--- | :--- |
| `mushi cache update` | なし | ローカルキャッシュをリモートリポジトリと同期 | `$CACHE_DIR` が存在しない場合は **`--depth 1` でクローン**。存在する場合は **`git pull`** を実行。 |
| `mushi cache clean` | なし | ローカルキャッシュディレクトリを削除 | `$CACHE_DIR` の内容を削除 |

---

### 3. 💾 キャッシュ管理の詳細

#### 3.1. リポジトリ情報

* **リポジトリURL**: `https://github.com/github/gitignore`
* **キャッシュ場所**: `~/.cache/mushi/github-gitignore/`

#### 3.2. 取得ロジック

1.  **キャッシュの自動取得**: `mushi create` コマンドが実行された際、キャッシュディレクトリが存在しない場合、自動的に **`git clone --depth 1 <URL> <PATH>`** を実行し、リポジトリの浅いクローンを取得します。
2.  **テンプレートの検索**: キャッシュディレクトリ内のファイル名のうち、拡張子が `.gitignore` のファイルをテンプレートとして認識します。
    * 例: `Go.gitignore` -> テンプレート名 `Go`
3.  **テンプレートの読み込み**: テンプレートファイルの内容をそのまま読み込みます。

---

### 4. 📝 共通無視設定の処理

#### 4.1. ファイルの自動生成

* `mushi` 実行時、**`~/.config/mushi/common.ignore`** の存在を確認します。
* ファイルが存在しない場合、**空のファイルとして自動で作成** します。

#### 4.2. 連結処理

最終的な `.gitignore` は、以下の内容をこの順序で連結して作成されます。

1.  **`~/.config/mushi/common.ignore`** の内容
2.  **改行** (`\n`)
3.  **選択されたテンプレートの内容**

> ⚠️ **注意**: テンプレートの内容が空である場合 (例: ファイルが存在しない)、エラーを出力し、処理を中断します。

---

### 5. 🖱️ インタラクティブ動作の詳細 (`mushi create -i`)

インタラクティブなテンプレート選択には、**charmbracelet/bubbles** の `list` コンポーネントを使用します。



#### 5.1. UI要件

* **表示リスト**: キャッシュディレクトリ内の `*.gitignore` ファイルから拡張子を除いたテンプレート名を表示します。
* **絞り込み (Filtering)**: ユーザーが入力したキーワードに基づいて、リアルタイムにリストを絞り込む機能を提供します。
* **選択**: 上下キーで移動し、`Enter` キーで選択を確定します。

#### 5.2. 動作フロー

1.  キャッシュ内の全テンプレート名をリスト化。
2.  `bubbles/list` を利用したUIを表示し、ユーザーによる選択を待機。
3.  ユーザーがテンプレートを選択後、非インタラクティブモードと同様にテンプレートを生成・出力。

---

### 6. 📦 依存ライブラリ

| ライブラリ | 用途 | 補足 |
| :--- | :--- | :--- |
| `github.com/spf13/cobra` | コマンドラインインターフェースの構築 | CLIの基盤、コマンド、フラグの定義 |
| `github.com/charmbracelet/bubbletea` | TUI (Text User Interface) フレームワーク | インタラクティブモード (`-i`) の基盤 |
| `github.com/charmbracelet/bubbles/list` | インタラクティブな絞り込みリストUIコンポーネント | テンプレート選択画面の実現 |
| `golang.org/x/sys/execabs` (または `os/exec`) | Gitコマンドの実行 | キャッシュのクローン (`git clone`) や更新 (`git pull`) の実現 |
| 標準ライブラリ (`os`, `path/filepath`, `io/ioutil`, etc.) | ファイル・ディレクトリの操作、パス解決 | 設定/キャッシュパスの解決、ファイルの読み書き |
